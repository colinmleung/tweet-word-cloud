!!! 5
html(lang='en')
    head
        link(rel='stylesheet', type='text/css', href='/styles/jqcloud.css')
        link(rel='stylesheet', type='text/css', href='/styles/master.css')
    body
        div#content
        div#content1
        script(type='text/javascript', src='http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js')
        script(type='text/javascript', src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js')
        script(type='text/javascript', src='/js/libs/jqcloud.js')
        script(type='text/javascript', src='http://localhost:8080/socket.io/socket.io.js')
        script
            var socket = io.connect('http://localhost');
            socket.emit('join hashtagcloud');
            
            var eligible_elements;
            socket.on('hashtag tweet', function (data) {
                eligible_elements = $("span[rel='" + data.hashtag + "']");
                var length = eligible_elements.length;
                for (var i = 0; i < length; i++) {
                    blink($(eligible_elements[i]));
                    //.effect("highlight", { color: "#ffffff" }, 1000);
                }
            });

            var hashtagcounts = $.parseJSON(!{JSON.stringify(data)});
            var mod_hashtagcounts = [];
            $.map(hashtagcounts, function(val, i) {
                mod_hashtagcounts[i] = {};
                mod_hashtagcounts[i].text = val.hashtag;
                mod_hashtagcounts[i].weight = val.count;
                mod_hashtagcounts[i].link = window.location.pathname + val.hashtag;
                mod_hashtagcounts[i].html = { rel: val.hashtag };
            });
            
            /*function blink(selector) {
                $(selector).fadeOut('slow', function(){
                    $(this).fadeIn('slow', function(){
                        blink(this);
                    });
                });
            }*/
            
            function blink(selector) {
                var orig_color = $(selector).css("color");
                $(selector).animate({
                    color: "#fff"
                }, 250);
                $(selector).animate({
                    color: orig_color
                }, 250);
            }
            
            $(function() {
                // When DOM is ready, select the container element and call the jQCloud method, passing the array of words as the first argument.
                $("#content1").jQCloud(mod_hashtagcounts, { width: $(window).width()*0.95, height: $(window).height()*0.95});
            });